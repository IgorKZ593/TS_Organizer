# TS_Organizer

**TS_Organizer** — это инструмент для автоматической обработки PDF-файлов с TermSheet-документами, их нормализации по ISIN-кодам и структурирования по папкам.

## Возможности
- Автоматический поиск PDF-файлов в папке `Data_in` (только из корня).
- Перемещение файлов в `Data_in/TS`.
- Нормализация имён файлов до формата `ISIN.pdf`.
- Сверка ISIN из имени файла с ISIN в содержимом PDF.
- Интерактивная обработка несоответствий с подтверждением.
- Поиск и удаление дублей с подтверждением.
- Перенос обработанной папки `TS` в `Data_work` с архивацией старой версии.
- Поддержка цветного вывода через `rich`.
- Обработка ошибок чтения файлов и предупреждения.

## Структура проекта
```
TS_Organizer/
│
├── ts_cleaner.py        # Основной скрипт
│
├── Data_in/             # Входная папка
│   ├── *.pdf             # Исходные PDF-файлы
│   └── TS/               # Временная папка для обработки
│
├── Data_work/           # Папка с готовыми результатами
│   └── TS/               # Обработанные TermSheet'ы
│
├── TS_archive/          # Архив старых версий TS
│   └── TS_dd_mm_yyyy/    # Архивная копия с датой
│
├── logs/                # (опционально) Логи работы
│
└── README.md            # Описание проекта
```

## Основные модули и функции

### 1. Подготовка
- `ensure_ts_folder()` — создаёт папку `Data_in/TS`.
- Проверка наличия старой папки `TS` в `Data_in` и удаление по запросу.

### 2. Поиск и перемещение файлов
- `list_pdfs_in_root()` — находит PDF-файлы в корне `Data_in`.
- `move_pdf_with_conflict_prompt()` — перемещает файл в `TS`, обрабатывая конфликты имён.

### 3. Нормализация имён
- `normalize_filenames_in_ts()` — переименовывает файлы в формат `ISIN.pdf` по ISIN из имени.
- Если ISIN в имени отсутствует, файл будет обработан на следующем шаге.

### 4. Сверка с содержимым PDF
- `extract_isin_from_pdf()` — извлекает ISIN из содержимого PDF.
- `interactive_fix_mismatched_isin()` — предлагает переименовать файл в соответствии с ISIN из документа.

### 5. Поиск дублей
- `find_duplicates_by_isin()` — находит дубликаты по ISIN.
- `interactive_remove_duplicates()` — предлагает удалить лишние копии.

### 6. Перенос в Data_work
- `move_ts_to_data_work_with_archive()` — переносит `TS` в `Data_work` с архивацией старой версии.

### 7. Финальный отчёт
- Перед завершением работы скрипта отображается список файлов в `Data_work/TS` и их количество.

## Регулярные выражения
- `ISIN_PATTERN` — строгая проверка ISIN: `\b[A-Z]{2}[A-Z0-9]{9}\d\b`
- `ISIN_FLEXIBLE_PATTERN` — поиск с учётом пробелов/дефисов.

## Зависимости
- **PyPDF2** — извлечение текста из PDF.
- **rich** — цветной вывод в консоль.

Установка:
```bash
pip install PyPDF2 rich
```

## Пример работы
1. В папку `Data_in` кладём PDF-файлы.
2. Запускаем:
```bash
python ts_cleaner.py
```
3. Скрипт:
   - Перемещает PDF в `TS`
   - Переименовывает по ISIN
   - Сверяет с содержимым
   - Удаляет дубли
   - Переносит в `Data_work`
   - Выводит финальный список файлов

## Автор
Разработано для автоматизации обработки TermSheet-документов в рамках проекта **TS_Organizer**.
